# Инфраструктура MaK-CRM

## Требования к окружению
- Node.js (LTS)
- yarn (classic)
- PostgreSQL (рекомендуется 14+)
- Redis
- S3-совместимое хранилище (или локальное)
- Docker
- Crowdin (для переводов)
- Lingui (i18n)

## CI/CD
- GitHub Actions (автоматизация тестов, сборки, деплоя)
- Docker Compose для локальной разработки
- Мониторинг: Prometheus, Grafana, Sentry
- Автоматизация миграций и синхронизации схем

## Особенности
- Поддержка горизонтального масштабирования
- Мульти-арендность (multi-tenant)
- Автоматизация тестирования и линтинга при каждом PR
- Резервное копирование и восстановление

## Схема инфраструктуры

                                  +----------------+
                                  |    DNS         |
                                  | (mak-crm.ru)   |
                                  +--------+-------+
                                           |
                                           v
+----------------+     +----------------+     +----------------+
|     CDN        | <-> | Load Balancer  | <-> |     WAF        |
+----------------+     +--------+-------+     +----------------+
                                |
                                v
            +------------------+-----------------+
            |                                    |
  +---------v----------+             +---------v----------+
  |  Web Server 1      |             |  Web Server 2      |
  | (Node.js)          |             | (Node.js)          |
  +---------+----------+             +---------+----------+
            |                                    |
            |                                    |
            |           +----------------+       |
            |           |   PostgreSQL   | <-----+
            |           +----------------+       |
            |                                    |
            |           +----------------+       |
            |           |    Redis       |       |
            |           +----------------+       |
            |                                    |
            |           +----------------+       |
            |           |  S3 Storage    |       |
            |           +----------------+       |
            |                                    |
            |           +----------------+       |
            |           | Telegram-бот   |       |
            |           +----------------+       |
            |                                    |
            |           +----------------+       |
            |           |  Crowdin       |       |
            |           +----------------+       |
            |                                    |
            |           +----------------+       |
            |           |  Lingui        |       |
            |           +----------------+       |
            |                                    |

## CI/CD и деплой
- **GitHub Actions** для тестирования, сборки и деплоя
- **Docker Compose** для локальной разработки и тестирования
- **Helm/Ansible** для продакшн-деплоя (по необходимости)

## Безопасность и мониторинг
- **Мониторинг:** Grafana, Prometheus, Sentry
- **Резервное копирование:** автоматизированные бэкапы PostgreSQL и S3
- **Логи:** централизованный сбор (например, ELK stack)

## Этапы развертывания

### Этап 1: Подготовка базовой инфраструктуры
1. Регистрация доменов и настройка DNS
2. Создание облачных ресурсов (VPC, подсети, группы безопасности)
3. Развертывание виртуальных машин для тестового окружения
4. Настройка PostgreSQL кластера
5. Настройка S3-хранилища и Redis

### Этап 2: Разработка и интеграция
1. Настройка CI/CD (GitHub Actions)
2. Docker Compose для локальной разработки
3. Интеграция Telegram-бота как отдельного сервиса
4. Настройка мониторинга и логирования

### Этап 3: Продакшн-деплой
1. Перенос приложения на продакшн-серверы
2. Настройка балансировщика и WAF
3. Подключение SSL
4. Включение резервного копирования и мониторинга

---

_Документ синхронизирован с инфраструктурными best practices twenty._
