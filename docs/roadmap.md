# Roadmap проекта MaK CRM (twenty)

Этот документ содержит поэтапный и детализированный план реализации системы MaK CRM на базе twenty (Node.js, NestJS, PostgreSQL, Redis).

## Этапы разработки

### Этап 0. Развёртывание и первичная настройка twenty CRM
- [x] Загрузка и установка актуальной версии twenty CRM (git clone или архив)
- [x] Проверка и установка зависимостей (Node.js, NestJS, PostgreSQL, Redis)
- [x] Базовый запуск приложения в dev-режиме
- [x] Ознакомление со структурой и best practices платформы
- [x] Первичная настройка структуры каталогов MaK-CRM
- [x] Фиксация исходного состояния для дальнейшей кастомизации

**Контроль после этапа:**
- [x] Приложение успешно запускается локально
- [x] Все зависимости установлены и рабочие
- [x] Структура каталогов согласована с ТЗ и roadmap
- [x] Документация по запуску обновлена

### Этап 1. Проектирование и подготовка (2 недели)
- [x] Сбор и формализация требований, анализ пожеланий заказчика (TZ CRM.md)
- [x] Проектирование архитектуры системы и базы данных (twenty, PostgreSQL)
- [x] Настройка репозитория, документации, регламентов и базовых процессов

**Контроль после этапа:**
- [x] Проверка полноты требований (сверка с TZ CRM.md и пожеланиями заказчика)
- [x] Валидация архитектуры с учётом масштабируемости и безопасности
- [x] Проверка готовности инфраструктуры (CI/CD, Docker)
- [x] Актуальность и полнота документации

### Этап 2. Базовая CRM-платформа (3-4 недели)
- [x] Развёртывание twenty и настройка NestJS-приложения
- [ ] Реализация моделей пользователей, ролей, клиентов, лидов (TypeORM)
- [ ] Аутентификация и RBAC (Passport.js, матрица прав)
- [ ] CRUD-интерфейсы на NestJS для основных сущностей (User, Client, Lead, Role)
- [ ] Миграции и генерация тестовых данных
- [ ] Импорт/экспорт клиентов (CSV, Excel, ручной ввод)
- [ ] Проверка на дубли при создании лида, уведомления ответственным
- [ ] Сегментация базы по источникам и принципам обработки
- [ ] Гибкая настройка статусов лида

**Контроль после этапа:**
- Smoke-тесты всех CRUD-интерфейсов
- Проверка RBAC: разграничение доступа для всех ролей
- Импорт/экспорт: тестирование на реальных файлах
- Проверка механизма дублей (создание лида с совпадающими данными)
- Валидация миграций и тестовых данных
- Минимальный UX review (удобство, отсутствие критичных багов)

### Этап 3. Воронки продаж и аукцион лидов (2-3 недели)
- [ ] Модели Pipeline, Stage, Deal, LeadAuction
- [ ] Гибкая настройка этапов сделки/воронки (редактируемые этапы, best practice amoCRM)
- [ ] Интерфейс управления воронками и стадиями (NestJS)
- [ ] Реализация аукциона лидов (логика ставок, история, UI)
- [ ] Перераспределение невыкупленных лидов

**Контроль после этапа:**
- Тест-кейсы на создание, изменение и удаление этапов воронки
- Проверка бизнес-логики аукциона (ставки, история, перераспределение)
- Smoke-тесты интерфейса управления воронками
- Валидация отображения истории сделок и лидов

### Этап 4. Личные кабинеты и мультитенантность (2-3 недели)
- [ ] Личный кабинет партнёра (статистика, лиды, рефералы, грейды, калькулятор прибыли)
- [ ] Личный кабинет франчайзи (лиды, сделки, аукцион, документы)
- [ ] Поддержка мультитенантности через tenant_id
- [ ] Расширенные поля регистрации/анкеты (город, ниша, ИП/ООО и др.)
- [ ] Двухуровневая реферальная программа
- [ ] Геймификация, обучение, домашние задания
- [ ] Взаиморасчёты: автоматическая генерация и хранение актов, договоров

**Контроль после этапа:**
- Smoke-тесты всех личных кабинетов (роль партнёр/франчайзи)
- Проверка ограничения доступа tenant_id (данные не видны другим)
- Тестирование реферальной программы (создание, переходы, начисления)
- Проверка корректности расчёта грейдов и калькулятора прибыли
- Проверка генерации и хранения документов

### Этап 5. Интеграции и API (2 недели)
- [ ] Двусторонняя интеграция с amoCRM (REST API, webhooks)
- [ ] Открытый REST API для внешних сервисов и площадок
- [ ] Интеграция с мессенджерами (Telegram, WhatsApp, внешние чаты)
- [ ] Импорт/экспорт данных (CSV, Excel, API)

**Контроль после этапа:**
- Проверка интеграции с amoCRM (двусторонний обмен, webhooks)
- Smoke-тесты REST API (Swagger/OpenAPI, ручные запросы)
- Тестирование интеграций с мессенджерами (отправка/приём сообщений)
- Проверка безопасности и авторизации для всех API

### Этап 6. Telegram-бот (2-3 недели)
- [ ] Разработка Telegram-бота на Node.js (Telegraf)
- [ ] Регистрация, аутентификация, работа с лидами, уведомления, FAQ
- [ ] Проверка дублей, расширенные поля регистрации
- [ ] Интеграция с основной CRM через API
- [ ] Интеграция с внешними чатами (Telegram/WhatsApp)

**Контроль после этапа:**
- Smoke-тесты всех сценариев бота (регистрация, лиды, уведомления)
- Проверка интеграции с CRM (создание/обновление лидов через бота)
- Тестирование обработки дублей и расширенных полей
- Проверка корректности уведомлений и FAQ

### Этап 7. Отчёты, аналитика, обучение (2 недели)
- [ ] Гибкий конструктор аналитических отчётов (группировка, фильтрация, экспорт по любым полям)
- [ ] Дашборды по клиентам, лидам, сделкам, KPI, эффективности
- [ ] Модули обучения, геймификации, реферальной программы
- [ ] Калькулятор прибыли для партнёров

**Контроль после этапа:**
- Smoke-тесты конструкторов отчётов (создание, фильтрация, экспорт)
- Проверка корректности дашбордов и аналитики
- Тестирование модулей обучения и геймификации
- Проверка калькулятора прибыли

### Этап 8. Безопасность, мониторинг, DevOps (1-2 недели)
- [ ] Реализация мониторинга (Prometheus, Grafana, Sentry)
- [ ] Резервное копирование PostgreSQL и S3
- [ ] Аудит безопасности, настройка WAF, VPN
- [ ] Логирование действий пользователей
- [ ] Защита персональных данных, аудит доступа

**Контроль после этапа:**
- Проверка работоспособности мониторинга и алёртов
- Тестирование восстановления из бэкапов
- Проведение аудита безопасности (OWASP, ручная проверка)
- Проверка логирования и аудита доступа

### Этап 9. Тестирование и релиз (1-2 недели)
- [ ] Покрытие тестами (Jest)
- [ ] Пользовательское тестирование (UAT)
- [ ] Подготовка к продакшн-деплою
- [ ] Документация для пользователей и разработчиков

**Контроль после этапа:**
- Проверка покрытия тестами (unit/integration)
- Проведение UAT с ключевыми пользователями
- Smoke-тесты продакшн-сборки
- Проверка полноты и актуальности документации

### Этап 10. Поддержка и развитие
- [ ] Мониторинг, обновления, новые функции по запросам пользователей
- [ ] Масштабирование системы
- [ ] Развитие интеграций и автоматизаций

**Контроль после этапа:**
- Регулярный мониторинг производительности и ошибок
- Сбор и анализ обратной связи пользователей
- Планирование и приоритизация новых фич
- Проверка масштабируемости при росте нагрузки

### Этап X. Синхронизация с best practices twenty
- [ ] Внедрение nx monorepo-структуры
- [ ] Подключение и настройка code style/линтеров (ESLint, Prettier)
- [ ] Внедрение строгой типизации (TypeScript strict, no any)
- [ ] Организация модулей по фичам (feature-modules)
- [ ] Внедрение тестирования (Jest, Playwright, Storybook, покрытие 80%+)
- [ ] Внедрение i18n (Lingui, Crowdin)
- [ ] Автоматизация CI/CD (GitHub Actions)
- [ ] Документирование гайдлайнов и стандартов
- [ ] Проверка соответствия структуры и кода правилам из .cursor/rules

**Контроль после этапа:**
- Все гайдлайны внедрены и описаны
- Покрытие тестами и линтинг автоматизированы
- Структура кода и документации соответствует twenty

### Финальный этап. Подготовка инфраструктуры к продакшену
- [ ] Подготовка инфраструктуры (серверы, домены, хранилища, Docker, CI/CD)

---

## Перспективные направления развития

### Первая очередь (после основного ТЗ)
- [ ] **Мобильная версия и адаптивность**
    - Оптимизация интерфейсов под мобильные (NestJS, PWA)
    - Проверка сценариев на смартфонах/планшетах
    - Smoke-тесты мобильного UX
- [ ] **Внутренняя база знаний**
    - Создание раздела документации и обучающих материалов
    - Поиск и структурирование FAQ
    - Smoke-тесты поиска и добавления статей
- [ ] **Юридические и compliance-модули**
    - Автоматизация проверок по спискам (ФНС/ФССП/санкции)
    - Хранение согласий на обработку ПД
    - Генерация и хранение юридических документов
    - Проверка корректности хранения и автоматизации

### Вторая очередь
- [ ] **AI/ML-модули**
    - Скоринг лидов, предиктивная аналитика, рекомендации
    - Автоматическая категоризация заявок, выявление аномалий
    - Smoke-тесты моделей и интеграций
- [ ] **Финансовые интеграции**
    - Интеграция с банками (статусы кредитов/платежей)
    - Выгрузка данных для бухгалтерии (1С, SAP)
    - Проверка корректности интеграций и выгрузок

### Третья очередь
- [ ] **Масштабирование и отказоустойчивость**
    - Кластеризация NestJS, балансировщики, hot-reload
    - Chaos testing, тестирование отказоустойчивости
    - Проверка failover и восстановления
- [ ] **Автоматизация пользовательской поддержки**
    - Система тикетов/обращений, интеграция с helpdesk
    - Проверка сценариев поддержки и интеграций
- [ ] **Аналитика поведения пользователей**
    - Сбор событий (event tracking), интеграция с Amplitude/GA/YM
    - Проверка полноты сбора и корректности данных

**Контроль после каждого этапа перспектив:**
- Smoke-тесты новых модулей и интеграций
- Проверка пользовательских сценариев и UX
- Валидация безопасности и соответствия требованиям
- Оценка влияния на производительность

---

_Документ актуален для MaK-CRM на базе twenty, май 2025._