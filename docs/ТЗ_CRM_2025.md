# Техническое задание на разработку CRM-системы и Telegram-бота для компании MaK CRM

## 1. Общие положения

### 1.1. Цель проекта
Создать единую платформу для эффективного взаимодействия между отделами компании, партнёрами и франчайзи, а также для автоматизации и стандартизации бизнес-процессов в сфере кредитного брокериджа.

### 1.2. Задачи проекта
- [ ] Ведение учета клиентов, контрагентов и статусов по ним
- [ ] Детальная аналитика (выручка, KPI, эффективность, партнёры)
- [ ] Обучение партнёров и франчайзи
- [ ] Верификация заемщиков
- [ ] Помощь в разработке кредитных программ и подача заявок в банки
- [ ] Управление клиентскими базами

### 1.3. Целевая аудитория
- Внутренние сотрудники (с ролями и правами)
- Партнёры (личный кабинет)
- Франчайзи (личный кабинет + встроенная CRM)

---

## 2. Функциональные требования

### 2.1. CRM-система

#### 2.1.1. База клиентов
- [ ] Список клиентов с контактными данными, разделение по источникам (партнёры, лидогенерация, холодная база, внешние источники, купленные базы)
- [ ] Импорт/экспорт клиентов (CSV, Excel, API, ручной ввод)
- [ ] Сегментация базы по источникам и способу обработки
- [ ] Гибкая настройка статусов лида (новый, от партнёра, аукцион, не выкуплен и др.)
- [ ] Аукцион лидов для франчайзи
- [ ] Перераспределение невыкупленных лидов
- [ ] Конструктор аналитических отчётов: группировка, фильтрация, экспорт по любым полям лида (имя, телефон, источник, дата, принцип обработки и др.)
- [ ] Проверка на дубли по ключевым полям (например, телефон, e-mail) при создании лида, с уведомлением ответственного менеджера

#### 2.1.2. Личный кабинет партнёра
- [ ] Блоки: о компании (редактируемый), обучение (статьи, видео, шаблоны), помощь (FAQ, интеграция с Telegram/WhatsApp чатами)
- [ ] Кабинет компании (реквизиты, ID, грейды)
- [ ] Лиды: форма заведения, интеграция с amoCRM, статусы, комментарии, сумма, аналитика, калькулятор прибыли, механика грейдов, напоминания и уведомления
- [ ] Геймификация и обучение (баллы, мероприятия, домашние задания)
- [ ] Взаиморасчёты: дата выдачи, сумма, комиссия, акты (автоматическая генерация и хранение документов)
- [ ] Двухуровневая реферальная программа: ссылки, статус, история лидов
- [ ] Расширенные поля регистрации/анкеты: город, ниша, ИП/ООО и др.

#### 2.1.3. Кабинет франчайзи
- [ ] Общая информация (как у партнёра)
- [ ] Панель клиента (карточка клиента, договор, сделки, аналитика, статусы, история, документы)
- [ ] Управление лидами (создание, обработка, статусы, возврат лидов)
- [ ] Аукцион лидов, обучение, геймификация
- [ ] Встроенная обучающая система

#### 2.1.4. Воронки продаж и этапы сделок
- [ ] Гибкая настройка этапов сделки/воронки (редактирование этапов, соответствие best practice amoCRM)

#### 2.1.5. Роли и права
- [ ] Гибкая настройка ролей: admin, employee, partner, franchisee, guest
- [ ] Разграничение доступа к разделам и данным (RBAC, матрица прав)

#### 2.1.6. Интеграции
- [ ] Двусторонняя интеграция с amoCRM (REST API, webhooks)
- [ ] Открытое API для сторонних сервисов и площадок
- [ ] Интеграция с мессенджерами (Telegram, WhatsApp, др.), интеграция с внешними чатами для быстрой коммуникации

#### 2.1.7. Аналитика и отчёты
- [ ] Гибкий конструктор отчётов (KPI, выручка, эффективность, конверсия, доход партнёра и др.), дашборды для разных ролей
- [ ] Экспорт отчётов (CSV, Excel)

#### 2.1.8. Безопасность и обработка данных
- [ ] Аутентификация и авторизация (JWT, OAuth2, 2FA)
- [ ] Логирование действий
- [ ] Защита персональных данных
- [ ] Валидация и обработка дублей (см. выше)

#### 2.1.9. Документы
- [ ] Автоматическая генерация и хранение актов, договоров и других документов

#### 2.1.10. Требования к запуску и развертыванию
- Система разворачивается на базе twenty (Elixir, Phoenix, PostgreSQL, Docker Compose).
- Для локального запуска используется Docker Compose с необходимыми сервисами (Phoenix, PostgreSQL, Redis, Telegram-бот).
- Запуск всех сервисов одной командой:

```bash
 docker compose up --build
```

- Для инициализации базы данных:

```bash
 docker compose exec app mix ecto.setup
```

- Подробнее о структуре каталогов и компонентах см. docs/architecture.md.

---

## 3. Telegram-бот

### 3.1. Основные функции
- [ ] Регистрация и аутентификация пользователей
- [ ] Работа с лидами (создание, проверка статусов, история)
- [ ] Уведомления о новых лидах и изменениях статусов
- [ ] Интерактивные сценарии, обучение, FAQ
- [ ] Интеграция с основной CRM через REST API
- [ ] Проверка на дубли при создании лида
- [ ] Расширенные поля регистрации (город, ниша, ИП/ООО и др.)
- [ ] Интеграция с внешними чатами (Telegram/WhatsApp)

---

## 4. Требования к архитектуре и инфраструктуре
- Использование Phoenix LiveView для UI (без отдельного SPA)
- PostgreSQL как основная база данных
- Redis для кэша, очередей и сессий
- S3-совместимое хранилище для файлов
- Docker Compose для локального и тестового развёртывания
- CI/CD на GitHub Actions
- Мониторинг (Prometheus, Grafana, Sentry)
- Вся бизнес-логика реализуется на сервере (Elixir)
- Возможность интеграции с другими мессенджерами (WhatsApp и др.)

---

## 5. Базовый план реализации
- [ ] Проектирование архитектуры и схемы БД
- [ ] Реализация моделей пользователей, клиентов, ролей, лидов
- [ ] Аутентификация и RBAC
- [ ] CRUD-интерфейсы на LiveView
- [ ] Интеграция с amoCRM
- [ ] Реализация Telegram-бота
- [ ] Импорт/экспорт данных
- [ ] Дашборды и отчёты
- [ ] Мониторинг и безопасность
- [ ] Документация и тесты

---

## 6. Перспективные направления развития (поэтапно)

### 6.1. Первая очередь — после реализации основного ТЗ

#### 6.1.1. Мобильная версия и адаптивность
- [ ] Оптимизация интерфейсов LiveView под мобильные устройства (smartphone-first UX)
- [ ] Проверка и доработка всех пользовательских сценариев на мобильных
- [ ] Возможность создания PWA (Progressive Web App) для быстрого доступа с мобильных устройств

#### 6.1.2. Внутренняя база знаний
- [ ] Раздел с документацией, обучающими материалами, FAQ для сотрудников, партнёров, франчайзи
- [ ] Поиск по базе знаний, структурирование по тематикам
- [ ] Возможность добавления новых статей и материалов через административный интерфейс

#### 6.1.3. Юридические и compliance-модули
- [ ] Автоматизация проверки клиентов по спискам ФНС/ФССП/санкций
- [ ] Хранение согласий на обработку персональных данных
- [ ] Автоматизация генерации и хранения юридических документов

### 6.2. Вторая очередь

#### 6.2.1. AI/ML-модули (перспектива)
- [ ] Предиктивная аналитика: скоринг лидов, прогнозирование конверсии, рекомендации по действиям
- [ ] Автоматическая категоризация заявок и выявление аномалий

#### 6.2.2. Финансовые интеграции
- [ ] Интеграция с банками для автоматического получения статусов по кредитам/платежам
- [ ] Возможность выгрузки данных для бухгалтерии (1С, SAP и др.)

### 6.3. Третья очередь

#### 6.3.1. Масштабирование и отказоустойчивость
- [ ] Подготовка к горизонтальному масштабированию (кластеризация Phoenix, балансировщики, hot-reload)
- [ ] Тестирование отказоустойчивости (chaos testing, имитация падения сервисов)

#### 6.3.2. Автоматизация пользовательской поддержки
- [ ] Внедрение системы тикетов/обращений (support tickets) внутри CRM
- [ ] Интеграция с внешними helpdesk-системами (Zendesk, Freshdesk и др.)

#### 6.3.3. Аналитика поведения пользователей
- [ ] Сбор событий (event tracking) для анализа поведения пользователей
- [ ] Интеграция с Amplitude, Yandex.Metrica, Google Analytics (через серверные события)

---

## 7. Требования к стилю, архитектуре и тестированию

- Строгая типизация TypeScript strict, запрещён any
- Использовать type вместо interface (кроме сторонних интерфейсов)
- Использовать string literal unions вместо enum
- Одна сущность/компонент — один файл
- Модули и директории по фичам (feature-modules)
- Тесты рядом с кодом, покрытие 80%+
- Локализация через Lingui, Crowdin, только через макросы
- Следовать гайдлайнам из .cursor/rules (code style, архитектура, тесты, переводы)
- Вся документация и структура кода должны быть синхронизированы с best practices twenty

---

_Требования синхронизированы с платформой twenty и актуальными best practices._

_Порядок внедрения: в первую очередь реализуется текущее ТЗ, далее — мобильность, база знаний, compliance; затем AI/ML и финансы; в последнюю очередь — масштабирование, поддержка, аналитика поведения._

_Документ актуален для MaK-CRM на базе twenty, май 2025._
